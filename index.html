<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        input:focus { border-color: #3b82f6 !important; outline: none; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-28 text-slate-900">
    <div id="root"></div>
    <script>
        const e = React.createElement;
        const { useState, useEffect, useRef } = React;

        const SPLITS = {
            'Push 1': ['Bench Press', 'Crossover', 'Skull Crusher', 'Tricep Extensions', 'Lateral Raises'],
            'Pull': ['Lat Pulldowns', 'Cable Rows', 'Chest supported row', 'Curls', 'Hammers'],
            'Hybrid': ['Leg extension', 'Hamstring curls', 'Leg raises', 'Cable crunches', 'Wrist curls', 'Cable reverse curl', 'Reverse fly'],
            'Push 2': ['Incline Bench Press', 'Chest fly', 'Skull Crusher', 'Tricep Pushdowns', 'Lateral Raises'],
            'Legs': ['Squats', 'Deadlifts', 'Leg extension', 'Hamstring curls', 'Cable crunches', 'Cable reverse curl'],
            'Rest': []
        };

        const PHASE_COLORS = { bulk: '#ef4444', cut: '#3b82f6', maintenance: '#eab308' };

        const Icon = {
            Plus: () => e('svg', {width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2.5}, e('line', {x1: 12, y1: 5, x2: 12, y2: 19}), e('line', {x1: 5, y1: 12, x2: 19, y2: 12})),
            X: () => e('svg', {width: 16, height: 16, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2.5}, e('line', {x1: 18, y1: 6, x2: 6, y2: 18}), e('line', {x1: 6, y1: 6, x2: 18, y2: 18})),
            Edit: () => e('svg', {width: 14, height: 14, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2.5}, e('path', {d: 'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7'}), e('path', {d: 'M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z'})),
            ChevronLeft: () => e('svg', {width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2.5}, e('polyline', {points: '15 18 9 12 15 6'})),
            ChevronRight: () => e('svg', {width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2.5}, e('polyline', {points: '9 18 15 12 9 6'})),
            Log: () => e('svg', {width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2}, e('path', {d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'}), e('polyline', {points: '14 2 14 8 20 8'})),
            Stats: () => e('svg', {width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2}, e('polyline', {points: '23 6 13.5 15.5 8.5 10.5 1 18'})),
            Settings: () => e('svg', {width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2}, e('circle', {cx: 12, cy: 12, r: 3}), e('path', {d: 'M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z'}))
        };

        function LineChart({data, dataKey, color, label, phases = []}) {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);
            useEffect(() => {
                if (!canvasRef.current || !data.length) return;
                if (chartRef.current) chartRef.current.destroy();
                const ctx = canvasRef.current.getContext('2d');
                
                const phaseBgPlugin = {
                    id: 'phaseBg',
                    beforeDraw: (chart) => {
                        const {ctx, chartArea, scales: {x}} = chart;
                        phases.forEach((p) => {
                            const startX = x.getPixelForValue(p.start.slice(5));
                            const endX = x.getPixelForValue(p.end.slice(5));
                            if (startX >= chartArea.left && startX <= chartArea.right) {
                                ctx.fillStyle = (PHASE_COLORS[p.type] || '#000') + '15';
                                ctx.fillRect(startX, chartArea.top, (endX || chartArea.right) - startX, chartArea.bottom - chartArea.top);
                            }
                        });
                    }
                };

                chartRef.current = new Chart(ctx, {
                    type: 'line',
                    data: { labels: data.map(d => d.date), datasets: [{ label, data: data.map(d => d[dataKey]), borderColor: color, backgroundColor: color + '20', tension: 0.3, fill: false, pointRadius: 4 }] },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        plugins: { legend: {display: false} }, 
                        scales: { 
                            y: { beginAtZero: false }, 
                            x: { 
                                grid: {display: false},
                                ticks: { autoSkip: true, maxTicksLimit: 12, maxRotation: 45, minRotation: 45 }
                            } 
                        } 
                    },
                    plugins: [phaseBgPlugin]
                });
                return () => chartRef.current?.destroy();
            }, [data, phases]);
            return e('div', {className: 'h-64 w-full mt-4'}, e('canvas', {ref: canvasRef}));
        }

        function FitnessTracker() {
            const [view, setView] = useState('log');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const [logs, setLogs] = useState({});
            const [exHist, setExHist] = useState({});
            const [phases, setPhases] = useState([]);
            const [showCalendar, setShowCalendar] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [calNavDate, setCalNavDate] = useState(new Date());
            const [editingPhase, setEditingPhase] = useState(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                const l = localStorage.getItem('fitness-logs');
                const h = localStorage.getItem('exercise-history');
                const p = localStorage.getItem('fitness-phases');
                if (l) setLogs(JSON.parse(l));
                if (h) setExHist(JSON.parse(h));
                if (p) setPhases(JSON.parse(p));
            }, []);

            const saveAll = (nl, nh, np) => {
                localStorage.setItem('fitness-logs', JSON.stringify(nl));
                localStorage.setItem('exercise-history', JSON.stringify(nh));
                localStorage.setItem('fitness-phases', JSON.stringify(np));
            };

            const getActivePhase = (d) => phases.find(p => d >= p.start && d <= p.end);
            const log = logs[date] || {split: '', bodyweight: '', exercises: [], food: [], notes: '', customCalGoal: null};
            const activePhase = getActivePhase(date);
            const currentGoal = log.customCalGoal || activePhase?.cals || 0;

            const updLog = (u) => {
                const nl = {...logs, [date]: {...log, ...u}};
                setLogs(nl);
                saveAll(nl, exHist, phases);
            };

            const updEx = (i, f, v) => {
                const exs = [...log.exercises];
                exs[i] = {...exs[i], [f]: v};
                const nl = {...logs, [date]: {...log, exercises: exs}};
                setLogs(nl);
                
                const ex = exs[i];
                if (ex.weight && ex.reps) {
                    const nh = {...exHist};
                    if (!nh[ex.name]) nh[ex.name] = [];
                    const ent = {date, weight: ex.weight, reps: ex.reps, note: ex.note || ''};
                    const idx = nh[ex.name].findIndex(e => e.date === date);
                    if (idx >= 0) nh[ex.name][idx] = ent; else nh[ex.name].unshift(ent);
                    setExHist(nh);
                    saveAll(nl, nh, phases);
                } else {
                    saveAll(nl, exHist, phases);
                }
            };

            const totals = log.food.reduce((a, b) => ({cal: a.cal + (Number(b.cal) || 0), pro: a.pro + (Number(b.pro) || 0)}), {cal: 0, pro: 0});

            return e('div', {className: 'max-w-2xl mx-auto p-4'},
                view === 'log' ? e('div', {className: 'slide-in'},
                    e('div', {className: 'bg-white rounded-[2rem] p-6 shadow-sm border border-slate-200 mb-6'},
                        e('div', {className: 'flex justify-between items-center mb-6'},
                            e('button', {onClick: () => { const d = new Date(date); d.setDate(d.getDate() - 1); setDate(d.toISOString().split('T')[0]); }}, e(Icon.ChevronLeft)),
                            e('div', {className: 'text-center cursor-pointer', onClick: () => { setCalNavDate(new Date(date)); setShowCalendar(true); }}, 
                                e('div', {className: 'font-black text-2xl text-slate-900 leading-tight'}, new Date(date + 'T12:00:00').toLocaleDateString('en-US', {month: 'short', day: 'numeric'})),
                                activePhase ? e('div', {className: `text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-full inline-block mt-1 ${activePhase.type === 'bulk' ? 'bg-red-100 text-red-600' : activePhase.type === 'cut' ? 'bg-blue-100 text-blue-600' : 'bg-yellow-100 text-yellow-600'}`}, activePhase.type) : e('div', {className: 'text-[10px] font-black uppercase tracking-widest text-slate-300 mt-1'}, 'No Active Phase')
                            ),
                            e('button', {onClick: () => { const d = new Date(date); d.setDate(d.getDate() + 1); setDate(d.toISOString().split('T')[0]); }}, e(Icon.ChevronRight))
                        ),
                        e('input', { type: 'number', placeholder: 'Bodyweight (lbs)', value: log.bodyweight, onChange: (ev) => updLog({bodyweight: ev.target.value}), className: 'w-full p-4 bg-slate-50 border-2 border-transparent rounded-2xl font-black text-center text-lg focus:bg-white focus:border-blue-100' })
                    ),
                    
                    !log.split ? e('div', {className: 'grid grid-cols-2 gap-3 mb-6'}, Object.keys(SPLITS).map(s => e('button', { key: s, onClick: () => updLog({split: s, exercises: SPLITS[s].map(n => ({name: n, weight: exHist[n]?.[0]?.weight || '', reps: exHist[n]?.[0]?.reps || '', note: exHist[n]?.[0]?.note || ''}))}), className: 'p-5 bg-blue-600 text-white rounded-3xl text-sm font-black shadow-lg shadow-blue-100 active:scale-95 transition-transform' }, s))) :
                    e('div', {className: 'space-y-4 mb-6'}, 
                        e('div', {className: 'flex justify-between items-center bg-white p-4 rounded-2xl border mb-2'}, e('span', {className:'font-black text-xs text-blue-600'}, log.split), e('button', {onClick:()=>updLog({split:'', exercises:[]}), className:'text-[10px] font-bold text-red-400 uppercase'}, 'Reset Split')),
                        log.exercises.map((ex, i) => e('div', {key: i, className: 'bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100 slide-in'}, 
                            e('div', {className: 'font-black text-slate-800 mb-4 flex justify-between'}, e('span', null, ex.name), (ex.weight && ex.reps) && e('div', {className: 'h-2 w-2 bg-green-500 rounded-full shadow-[0_0_8px_rgba(34,197,94,0.4)]'})), 
                            e('div', {className: 'grid grid-cols-2 gap-3 mb-3 font-mono text-slate-900'}, 
                                e('input', { type: 'number', placeholder: 'Wt', value: ex.weight, onChange: (ev) => updEx(i, 'weight', ev.target.value), className: 'p-3 bg-slate-50 rounded-xl font-bold text-lg text-center' }), 
                                e('input', { type: 'number', placeholder: 'Reps', value: ex.reps, onChange: (ev) => updEx(i, 'reps', ev.target.value), className: 'p-3 bg-slate-50 rounded-xl font-bold text-lg text-center' })
                            ),
                            e('input', { type: 'text', placeholder: 'Note...', value: ex.note, onChange: (ev) => updEx(i, 'note', ev.target.value), className: 'w-full p-2 bg-slate-50 rounded-lg text-xs italic text-slate-500' })
                        ))
                    ),

                    e('div', {className: 'bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100 mb-6'}, 
                        e('div', {className: 'flex justify-between items-center mb-4 text-slate-800'}, e('h2', {className: 'font-black'}, 'Food & Macros'), e('button', {onClick: () => updLog({food: [...log.food, {name:'', cal:'', pro:''}]}), className: 'p-2 bg-blue-50 rounded-full text-blue-600'}, e(Icon.Plus))), 
                        log.food.map((f, i) => e('div', {key: i, className: 'flex gap-2 mb-2 items-center'}, 
                            e('input', { placeholder: 'Food item', value: f.name, onChange: (ev) => { const fd = [...log.food]; fd[i].name = ev.target.value; updLog({food: fd}); }, className: 'flex-1 p-2 bg-slate-50 rounded-lg text-sm font-bold' }), 
                            e('input', { type: 'number', placeholder: 'Cal', value: f.cal, onChange: (ev) => { const fd = [...log.food]; fd[i].cal = ev.target.value; updLog({food: fd}); }, className: 'w-16 p-2 bg-slate-50 rounded-lg text-sm text-center font-bold' }), 
                            e('input', { type: 'number', placeholder: 'Pro', value: f.pro, onChange: (ev) => { const fd = [...log.food]; fd[i].pro = ev.target.value; updLog({food: fd}); }, className: 'w-16 p-2 bg-slate-50 rounded-lg text-sm text-center font-bold' }), 
                            e('button', {onClick: () => updLog({food: log.food.filter((_,j)=>j!==i)}), className: 'text-slate-300'}, e(Icon.X))
                        )), 
                        e('div', {className:'mt-6 p-4 bg-slate-50 rounded-2xl grid grid-cols-2 gap-4 text-slate-800'},
                            e('div', null, e('div', {className:'text-[9px] font-bold text-slate-400 uppercase'}, 'Remaining Cals'), e('div', {className:'font-black text-xl'}, currentGoal ? (currentGoal - totals.cal) : '--'), activePhase && e('input',{type:'number', value:currentGoal, onChange:(ev)=>updLog({customCalGoal:Number(ev.target.value)}), className:'text-[10px] bg-transparent text-blue-500 font-bold w-12'})),
                            e('div', null, e('div', {className:'text-[9px] font-bold text-slate-400 uppercase'}, 'Total Protein'), e('div', {className:'font-black text-xl text-emerald-600'}, totals.pro + 'g'))
                        )
                    ),
                    e('textarea', { placeholder: 'Daily Journal...', value: log.notes, onChange: (ev) => updLog({notes: ev.target.value}), className: 'w-full p-4 bg-white border border-slate-100 rounded-3xl text-sm h-24 mb-10 shadow-sm italic text-slate-600' })
                ) : e('div', {className: 'slide-in mb-24 text-slate-800'},
                    e('h1', {className: 'text-2xl font-black mb-6'}, 'Analytics'),
                    Object.entries(logs).filter(([_, l]) => l.bodyweight).length > 0 && e('div', {className: 'bg-white p-6 rounded-3xl shadow-sm border mb-6'}, e('h2', {className: 'font-bold text-blue-600 mb-2'}, 'Bodyweight Trend'), e(LineChart, {data: Object.entries(logs).filter(([_, l]) => l.bodyweight).map(([d, l]) => ({date: d.slice(5), fullDate: d, weight: Number(l.bodyweight)})).sort((a,b) => a.fullDate.localeCompare(b.fullDate)), dataKey: 'weight', color: '#3b82f6', label: 'lbs', phases: phases})),
                    Object.keys(exHist).sort().map(name => e('div', {key: name, className: 'bg-white p-6 rounded-3xl shadow-sm border mb-6'}, e('h2', {className: 'font-bold mb-2 text-slate-800'}, name), e(LineChart, {data: [...exHist[name]].reverse().map(d => ({date: d.date.slice(5), fullDate: d.date, weight: Number(d.weight)})), dataKey: 'weight', color: '#10b981', label: 'lbs', phases: phases})))
                ),

                e('div', {className: 'fixed bottom-0 left-0 right-0 glass-effect border-t flex justify-around p-4 shadow-2xl z-40'},
                    e('button', {onClick: () => setView('log'), className: `flex flex-col items-center ${view === 'log' ? 'text-blue-600' : 'text-slate-400'}`}, e(Icon.Log), e('span', {className: 'text-[9px] font-bold uppercase mt-1'}, 'Log')),
                    e('button', {onClick: () => setView('stats'), className: `flex flex-col items-center ${view === 'stats' ? 'text-blue-600' : 'text-slate-400'}`}, e(Icon.Stats), e('span', {className: 'text-[9px] font-bold uppercase mt-1'}, 'Stats')),
                    e('button', {onClick: () => setShowSettings(true), className: 'flex flex-col items-center text-slate-400'}, e(Icon.Settings), e('span', {className: 'text-[9px] font-bold uppercase mt-1'}, 'Setup'))
                ),

                showSettings && e('div', {className: 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 backdrop-blur-sm text-slate-900'},
                    e('div', {className: 'bg-white rounded-[2.5rem] p-8 w-full max-w-md slide-in shadow-2xl overflow-y-auto max-h-[85vh]'},
                        e('div', {className: 'flex justify-between items-start mb-6'}, e('h2', {className: 'text-2xl font-black text-slate-900'}, 'Phase Setup'), e('button', {onClick: () => setShowSettings(false)}, e(Icon.X))),
                        e('div', {className: 'space-y-4 mb-8 bg-slate-50 p-4 rounded-3xl'}, 
                            e('h3', {className: 'text-xs font-black text-slate-400 uppercase tracking-widest leading-none mb-1'}, editingPhase ? 'Edit Period' : 'New Period'),
                            e('div', {className: 'grid grid-cols-2 gap-2 text-slate-900'}, e('input', { type: 'date', id: 'pStart', className: 'p-3 bg-white rounded-xl text-xs font-bold' }), e('input', { type: 'date', id: 'pEnd', className: 'p-3 bg-white rounded-xl text-xs font-bold' })),
                            e('div', {className: 'flex gap-2'}, e('select', { id: 'pType', className: 'flex-1 p-3 bg-white rounded-xl text-xs font-bold' }, e('option',{value:'cut'},'Cut'), e('option',{value:'bulk'},'Bulk'), e('option',{value:'maintenance'},'Maintenance')), e('input', { type: 'number', id: 'pCal', placeholder: 'Goal', className: 'w-24 p-3 bg-white rounded-xl text-xs font-bold' })),
                            e('button', { onClick: () => {
                                const start = document.getElementById('pStart').value; const end = document.getElementById('pEnd').value; const type = document.getElementById('pType').value; const cals = document.getElementById('pCal').value;
                                if(start && end && cals){
                                    let np = editingPhase ? phases.map(p => p.id === editingPhase ? { ...p, start, end, type, cals: Number(cals) } : p) : [...phases, { id: Date.now(), start, end, type, cals: Number(cals) }];
                                    setPhases(np); setEditingPhase(null); saveAll(logs, exHist, np);
                                    document.getElementById('pStart').value = ''; document.getElementById('pEnd').value = ''; document.getElementById('pCal').value = '';
                                }
                            }, className: 'w-full p-4 bg-blue-600 text-white rounded-2xl font-black text-xs' }, editingPhase ? 'UPDATE' : 'ADD'),
                            editingPhase && e('button', { onClick: () => setEditingPhase(null), className: 'w-full mt-2 text-[10px] text-slate-400 font-bold uppercase' }, 'Cancel Edit')
                        ),
                        e('div', {className: 'space-y-3'}, phases.map(p => e('div', {key: p.id, className: `p-4 rounded-2xl border-2 flex justify-between items-center ${p.type === 'bulk' ? 'bg-red-50 border-red-100' : p.type === 'cut' ? 'bg-blue-50 border-blue-100' : 'bg-yellow-50 border-yellow-100'}`}, e('div', null, e('div', {className: 'font-black text-sm uppercase leading-none'}, p.type), e('div', {className: 'text-[10px] opacity-70 font-bold text-slate-800'}, p.start + ' to ' + p.end)), e('div', {className: 'flex gap-2 text-slate-900'}, e('button', { className: 'p-2 bg-white/50 rounded-lg', onClick: () => { setEditingPhase(p.id); document.getElementById('pStart').value = p.start; document.getElementById('pEnd').value = p.end; document.getElementById('pType').value = p.type; document.getElementById('pCal').value = p.cals; } }, e(Icon.Edit)), e('button', { onClick: () => { const np = phases.filter(ph => ph.id !== p.id); setPhases(np); saveAll(logs, exHist, np); } }, e(Icon.X)))))),
                        e('div', {className: 'pt-6 border-t mt-6 space-y-2'}, e('button', { onClick: () => { const data = { logs, exHist, phases }; const blob = new Blob([JSON.stringify(data)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'backup.json'; a.click(); }, className: 'w-full p-4 bg-slate-900 text-white rounded-2xl font-bold text-xs uppercase' }, 'Export Backup'), e('button', { onClick: () => fileInputRef.current.click(), className: 'w-full p-4 bg-slate-100 rounded-2xl font-bold text-xs uppercase text-slate-900' }, 'Import Backup'), e('input', { ref: fileInputRef, type: 'file', onChange: (ev) => { const r = new FileReader(); r.onload = (e) => { const d = JSON.parse(e.target.result); setLogs(d.logs); setExHist(d.exHist); setPhases(d.phases || []); saveAll(d.logs, d.exHist, d.phases || []); setShowSettings(false); }; r.readAsText(ev.target.files[0]); }, className: 'hidden' }))
                    )
                ),

                showCalendar && e('div', {className: 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6 backdrop-blur-sm text-slate-900'},
                    e('div', {className: 'bg-white rounded-[2.5rem] p-6 w-full max-w-sm slide-in shadow-2xl text-slate-900'},
                        e('div', {className: 'flex justify-between items-center mb-6 text-slate-900'}, e('button', { onClick: () => setCalNavDate(new Date(calNavDate.setMonth(calNavDate.getMonth() - 1))) }, e(Icon.ChevronLeft)), e('div', {className: 'font-black text-lg text-slate-800'}, calNavDate.toLocaleDateString('en-US', {month: 'long', year: 'numeric'})), e('button', { onClick: () => setCalNavDate(new Date(calNavDate.setMonth(calNavDate.getMonth() + 1))) }, e(Icon.ChevronRight))),
                        e('div', {className: 'calendar-grid mb-2 font-bold text-[10px] text-slate-300 uppercase tracking-tighter'}, ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d => e('div', {key:d, className:'text-center'}, d))),
                        e('div', {className: 'calendar-grid'}, Array.from({length: new Date(calNavDate.getFullYear(), calNavDate.getMonth(), 1).getDay()}, (_, i) => e('div', {key: 'empty-'+i})).concat(Array.from({length: new Date(calNavDate.getFullYear(), calNavDate.getMonth() + 1, 0).getDate()}, (_, i) => {
                            // FIXED: Constructing local date string manually to avoid timezone shift
                            const y = calNavDate.getFullYear();
                            const m = String(calNavDate.getMonth() + 1).padStart(2, '0');
                            const d = String(i + 1).padStart(2, '0');
                            const dVal = `${y}-${m}-${d}`;
                            const p = getActivePhase(dVal);
                            return e('button', { key: i, onClick: () => { setDate(dVal); setShowCalendar(false); }, className: `p-2 rounded-xl text-sm font-bold border-2 transition-all ${date === dVal ? 'border-black bg-slate-100' : p ? (p.type === 'bulk' ? 'bg-red-50 text-red-600 border-red-100' : p.type === 'cut' ? 'bg-blue-50 text-blue-600 border-blue-100' : 'bg-yellow-50 text-yellow-600 border-yellow-100') : 'border-transparent text-slate-400 hover:bg-slate-50'}` }, i+1);
                        }))),
                        e('button', { onClick: () => setShowCalendar(false), className: 'w-full mt-6 p-4 bg-slate-100 rounded-2xl font-black text-xs uppercase' }, 'Close')
                    )
                )
            );
        }
        ReactDOM.render(e(FitnessTracker), document.getElementById('root'));
    </script>
</body>
</html>
